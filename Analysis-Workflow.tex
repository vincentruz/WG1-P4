\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage[]{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\PassOptionsToPackage{hyphens}{url} % url is loaded by hyperref
\usepackage[unicode=true]{hyperref}
\hypersetup{
            pdftitle={SEISMIC WG1-P4},
            pdfauthor={Eben},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

% set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother

\usepackage{etoolbox}
\makeatletter
\providecommand{\subtitle}[1]{% add subtitle to \maketitle
  \apptocmd{\@title}{\par {\large #1 \par}}{}{}
}
\makeatother

\title{SEISMIC WG1-P4}
\providecommand{\subtitle}[1]{}
\subtitle{Analysis Workflow}
\author{Eben}
\date{4/17/2020}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{2}
\tableofcontents
}
\section{\texorpdfstring{\textbf{Data Processing (Institution
Specific)}}{Data Processing (Institution Specific)}}\label{data-processing-institution-specific}

(see
\href{https://docs.google.com/spreadsheets/d/1SzU4PcIEUsAGnKKyAcugHO2O2aZW29sf9a_cC-FAElk/edit\#gid=1679989021}{Data
Description} for shared SEISMIC variable names)

\subsection{0. Startup}\label{startup}

\subsubsection{a. Load R pkgs}\label{a.-load-r-pkgs}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{ (}\OperatorTok{!}\KeywordTok{require}\NormalTok{(}\StringTok{"pacman"}\NormalTok{)) }\KeywordTok{install.packages}\NormalTok{(}\StringTok{"pacman"}\NormalTok{)}
\KeywordTok{library}\NormalTok{(pacman)}
\NormalTok{pacman}\OperatorTok{::}\KeywordTok{p_load}\NormalTok{(}\StringTok{"tidyverse"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{b. Load full dataset}\label{b.-load-full-dataset}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# CHANGE TO YOUR FILE PATH}
\NormalTok{df_full <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"~/YOUR FILE PATH HERE.csv"}\NormalTok{)}
\KeywordTok{head}\NormalTok{(}\KeywordTok{names}\NormalTok{(df_full))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "X"                      "EMPLID_H"               "ACADEMIC_PLAN_DESCR"   
## [4] "ACADEMIC_PROGRAM_CD"    "ACADEMIC_PROGRAM_DESCR" "BIRTH_DT"
\end{verbatim}

\subsection{1. Clean Student level
variables}\label{clean-student-level-variables}

\subsubsection{a. Rename and generate/recode student level variables as
needed to match common SEISMIC AP variable
names}\label{a.-rename-and-generaterecode-student-level-variables-as-needed-to-match-common-seismic-ap-variable-names}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{## Student Level ####}
\NormalTok{df_std <-}\StringTok{ }\NormalTok{df_full }\OperatorTok{%>%}
\StringTok{  }\CommentTok{# Renamed variables}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{st_id =}\NormalTok{ EMPLID_H) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{ethniccode =}\NormalTok{ ETHNIC_GROUP_CD) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{famincome =} \KeywordTok{abs}\NormalTok{(AGI)) }\OperatorTok{%>%}
\StringTok{  }\CommentTok{# Recoded variable}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{firstgen =} \KeywordTok{recode}\NormalTok{(FIRST_GENERATION_DESCR, }\StringTok{"First Generation"}\NormalTok{ =}\StringTok{ }\DecValTok{1}\NormalTok{, }\StringTok{"Not First Generation"}\NormalTok{ =}\StringTok{ }\DecValTok{0}\NormalTok{, }\StringTok{"Unknown"}\NormalTok{ =}\StringTok{ }\DecValTok{0}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{ethniccode_cat =} \KeywordTok{recode}\NormalTok{(ETHNIC_GROUP_CD, }\StringTok{"HISPA"}\NormalTok{ =}\StringTok{ }\DecValTok{1}\NormalTok{, }\StringTok{"BLACK"}\NormalTok{ =}\StringTok{ }\DecValTok{1}\NormalTok{, }\StringTok{"AMIND"}\NormalTok{ =}\StringTok{ }\DecValTok{1}\NormalTok{, }\StringTok{"PACIF"}\NormalTok{ =}\StringTok{ }\DecValTok{1}\NormalTok{, }\StringTok{"ASIAN"}\NormalTok{ =}\StringTok{ }\DecValTok{2}\NormalTok{, }\StringTok{"WHITE"}\NormalTok{ =}\StringTok{ }\DecValTok{0}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{urm =} \KeywordTok{recode}\NormalTok{(ETHNIC_GROUP_CD, }\StringTok{"HISPA"}\NormalTok{ =}\StringTok{ }\DecValTok{1}\NormalTok{, }\StringTok{"BLACK"}\NormalTok{ =}\StringTok{ }\DecValTok{1}\NormalTok{, }\StringTok{"AMIND"}\NormalTok{ =}\StringTok{ }\DecValTok{1}\NormalTok{, }\StringTok{"PACIF"}\NormalTok{ =}\StringTok{ }\DecValTok{1}\NormalTok{, }\StringTok{"ASIAN"}\NormalTok{ =}\StringTok{ }\DecValTok{0}\NormalTok{, }\StringTok{"WHITE"}\NormalTok{ =}\StringTok{ }\DecValTok{0}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{gender =} \KeywordTok{recode}\NormalTok{(GENDER_CD, }\StringTok{"F"}\NormalTok{=}\DecValTok{1}\NormalTok{, }\StringTok{"M"}\NormalTok{=}\DecValTok{0}\NormalTok{, }\StringTok{"m"}\NormalTok{=}\DecValTok{0}\NormalTok{, }\StringTok{"U"}\NormalTok{ =}\StringTok{ }\DecValTok{2}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{female =} \KeywordTok{recode}\NormalTok{(GENDER_CD, }\StringTok{"F"}\NormalTok{=}\DecValTok{1}\NormalTok{, }\StringTok{"M"}\NormalTok{=}\DecValTok{0}\NormalTok{, }\StringTok{"m"}\NormalTok{=}\DecValTok{0}\NormalTok{, }\StringTok{"U"}\NormalTok{ =}\StringTok{ }\DecValTok{2}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{lowincomflag =} \KeywordTok{if_else}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(AGI), }\DecValTok{0}\NormalTok{,}
                                \KeywordTok{if_else}\NormalTok{(AGI }\OperatorTok{<=}\StringTok{ }\DecValTok{46435}\NormalTok{, }\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{))) }

\CommentTok{# etc...}
\end{Highlighting}
\end{Shaded}

\subsection{2. Clean Course level
variables}\label{clean-course-level-variables}

\subsubsection{a. Rename and generate/recode course level variables as
needed to match common SEISMIC AP variable
names}\label{a.-rename-and-generaterecode-course-level-variables-as-needed-to-match-common-seismic-ap-variable-names}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{## Course Level ####}
\NormalTok{df_crs <-}\StringTok{ }\NormalTok{df_full }\OperatorTok{%>%}
\StringTok{  }\CommentTok{# Renamed variables}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{st_id =}\NormalTok{ EMPLID_H) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{crs_sbj =}\NormalTok{ SUBJECT_CD) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{crs_catalog =}\NormalTok{ CATALOG_NBR) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{crs_name   =}\NormalTok{ CLASS_TITLE) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{crs_retake =}\NormalTok{ REPEAT_CD) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{crs_term   =}\NormalTok{ TERM_CD) }\OperatorTok{%>%}
\StringTok{  }\CommentTok{# Recoded variables}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{numgrade =}\NormalTok{ GRADE_POINTS}\OperatorTok{/}\NormalTok{UNITS_TAKEN) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{numgrade_w =} \KeywordTok{if_else}\NormalTok{(COURSE_GRADE_CD }\OperatorTok{==}\StringTok{ "W"}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{separate}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(}\StringTok{"TERM_CD"}\NormalTok{), }\KeywordTok{c}\NormalTok{(}\StringTok{"crs_YEAR"}\NormalTok{, }\StringTok{"crs_SEMESTER"}\NormalTok{), }\DecValTok{3}\NormalTok{, }\DataTypeTok{remove =} \OtherTok{FALSE}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{separate}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(}\StringTok{"crs_YEAR"}\NormalTok{), }\KeywordTok{c}\NormalTok{(}\StringTok{"crs_DEC"}\NormalTok{, }\StringTok{"crs_YEAR"}\NormalTok{), }\DecValTok{1}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{crs_term_yr =}\NormalTok{ crs_YEAR) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{crs_term_sem =}\NormalTok{ crs_SEMESTER) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{summer_crs =} \KeywordTok{if_else}\NormalTok{(}\KeywordTok{endsWith}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(TERM_CD),}\StringTok{"7"}\NormalTok{), }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{))}

\CommentTok{# etc...}
\end{Highlighting}
\end{Shaded}

\subsubsection{b. For each subject course (1 and 2), create dataframe of
only first time taking that
course}\label{b.-for-each-subject-course-1-and-2-create-dataframe-of-only-first-time-taking-that-course}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# By Course (Taking only First Attempt) ####}
\CommentTok{# Bio}
\NormalTok{df_crs_bio1 <-}\StringTok{ }\NormalTok{df_crs }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(crs_sbj }\OperatorTok{==}\StringTok{ "BIOSC"} \OperatorTok{&}\StringTok{ }\NormalTok{(crs_catalog }\OperatorTok{==}\StringTok{ "0150"}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\CommentTok{# | crs_catalog == "0715")) %>%}
\StringTok{  }\CommentTok{#Only first time taking course}
\StringTok{  }\KeywordTok{group_by}\NormalTok{(st_id, crs_catalog) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{arrange}\NormalTok{(crs_term, }\DataTypeTok{.by_group=} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{crs_retake_num =} \KeywordTok{row_number}\NormalTok{()) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(crs_retake_num }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\CommentTok{#Only first time taking course (incl. Honors)}
\StringTok{  }\KeywordTok{group_by}\NormalTok{(st_id) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{arrange}\NormalTok{(crs_term, }\DataTypeTok{.by_group=} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{crs_retake_num2 =} \KeywordTok{row_number}\NormalTok{()) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(crs_retake_num2 }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{)}

\CommentTok{# repeat for Bio2, Chem1, Chem2, Phys1, Phys2}
\end{Highlighting}
\end{Shaded}

\subsection{3. Clean AP Level variables}\label{clean-ap-level-variables}

\subsubsection{a. For each AP subject, rename and generate/recode course
level variables as needed to match common SEISMIC AP variable
names}\label{a.-for-each-ap-subject-rename-and-generaterecode-course-level-variables-as-needed-to-match-common-seismic-ap-variable-names}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{##### AP Level ####}
\CommentTok{# By course ####}
\CommentTok{# Bio}
\NormalTok{df_ap_bio <-}\StringTok{ }\NormalTok{df_full }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{st_id =}\NormalTok{ EMPLID_H) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{aptaker =} \KeywordTok{ifelse}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(BY), }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{apskipper =} \KeywordTok{ifelse}\NormalTok{(BY }\OperatorTok{>=}\StringTok{ }\DecValTok{4} \OperatorTok{&}\StringTok{ }\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(BY), }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{apskipper_2 =} \KeywordTok{ifelse}\NormalTok{(BY }\OperatorTok{==}\StringTok{ }\DecValTok{5} \OperatorTok{&}\StringTok{ }\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(BY), }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{tookcourse =} \KeywordTok{ifelse}\NormalTok{(}
\NormalTok{    SUBJECT_CD }\OperatorTok{==}\StringTok{ "BIOSC"} \OperatorTok{&}\StringTok{ }\NormalTok{(CATALOG_NBR }\OperatorTok{==}\StringTok{ "0150"}\NormalTok{) }\OperatorTok{&}\StringTok{ }\CommentTok{# | CATALOG_NBR == "0715") & }
\StringTok{      }\NormalTok{COURSE_GRADE_CD }\OperatorTok{!=}\StringTok{ "W"}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{tookcourse_2 =} \KeywordTok{ifelse}\NormalTok{(}
\NormalTok{    SUBJECT_CD }\OperatorTok{==}\StringTok{ "BIOSC"} \OperatorTok{&}\StringTok{ }\NormalTok{(CATALOG_NBR }\OperatorTok{==}\StringTok{ "0160"}\NormalTok{) }\OperatorTok{&}\StringTok{ }\CommentTok{# | CATALOG_NBR == "0716") & }
\StringTok{      }\NormalTok{COURSE_GRADE_CD }\OperatorTok{!=}\StringTok{ "W"}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\CommentTok{#mutate(apyear = ?) %>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{apscore =} \KeywordTok{as.character}\NormalTok{(BY)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{apscore_full =} \KeywordTok{ifelse}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(BY), }\DecValTok{0}\NormalTok{, BY)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(st_id, aptaker}\OperatorTok{:}\NormalTok{apscore_full) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{group_by}\NormalTok{(st_id) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{summarize_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(}\OperatorTok{-}\KeywordTok{group_cols}\NormalTok{()),max)}

\CommentTok{# repeat for Chem, Phys}
\end{Highlighting}
\end{Shaded}

\subsection{4. Create stacked dataset}\label{create-stacked-dataset}

\subsubsection{a. For each course subject, join previously create
dataframes for first time taking Course1, Course2, and
AP}\label{a.-for-each-course-subject-join-previously-create-dataframes-for-first-time-taking-course1-course2-and-ap}

\begin{itemize}
\tightlist
\item
  Include new variable: ``discipline'' as flag for each subject

  \begin{itemize}
  \tightlist
  \item
    BIO
  \item
    CHEM
  \item
    PHYS
  \end{itemize}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Bio (N=3090)}
\NormalTok{df_bio <-}\StringTok{ }\NormalTok{df_std }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{right_join}\NormalTok{(df_crs_bio2, }\DataTypeTok{by =} \StringTok{"st_id"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{full_join}\NormalTok{(df_crs_bio1, }\DataTypeTok{by =} \StringTok{"st_id"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{full_join}\NormalTok{(df_ap_bio, }\DataTypeTok{by =} \StringTok{"st_id"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{discipline =} \StringTok{"BIO"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{skipped_1 =} \KeywordTok{ifelse}\NormalTok{(tookcourse }\OperatorTok{==}\StringTok{ }\DecValTok{0} \OperatorTok{&}\StringTok{ }\NormalTok{tookcourse_}\DecValTok{2} \OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(discipline, st_id}\OperatorTok{:}\NormalTok{hsgpa, crs_sbj.x}\OperatorTok{:}\NormalTok{current_major.x, crs_sbj.y}\OperatorTok{:}\NormalTok{current_major.y, }
\NormalTok{         aptaker, apscore, apscore_full, apskipper, }
\NormalTok{         tookcourse, tookcourse_}\DecValTok{2}\NormalTok{, skipped_}\DecValTok{1}\NormalTok{) }

\CommentTok{# repeat for Chem, Phys}
\end{Highlighting}
\end{Shaded}

\subsubsection{b. Stack all dataframes, with course
indicator}\label{b.-stack-all-dataframes-with-course-indicator}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Stacked dataframe with Bio, Chem, Phys}
\NormalTok{df_clean <-}\StringTok{ }\KeywordTok{rbind}\NormalTok{(df_bio, df_chem, df_phys)}
\NormalTok{df_clean <-}\StringTok{ }\NormalTok{df_clean }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{rename_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(}\KeywordTok{ends_with}\NormalTok{(}\StringTok{".x"}\NormalTok{)), }
            \OperatorTok{~}\NormalTok{(}\KeywordTok{str_replace}\NormalTok{(., }\StringTok{".x"}\NormalTok{, }\StringTok{"_2"}\NormalTok{))) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{rename_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(}\KeywordTok{ends_with}\NormalTok{(}\StringTok{".y"}\NormalTok{)), }
            \OperatorTok{~}\NormalTok{(}\KeywordTok{str_replace}\NormalTok{(., }\StringTok{".y"}\NormalTok{, }\StringTok{""}\NormalTok{)))}

\KeywordTok{rm}\NormalTok{(df_ap_bio, df_ap_chem, df_ap_phys, }
\NormalTok{   df_bio, df_chem, df_phys, }
\NormalTok{   df_crs_bio1, df_crs_bio2, df_crs_chem1, df_crs_chem2, df_crs_phys1, df_crs_phys2,}
\NormalTok{   df_crs, df_std)}
\end{Highlighting}
\end{Shaded}

\subsubsection{\texorpdfstring{c. Should end up with something that
looks like
\href{https://docs.google.com/spreadsheets/d/1Sj5kaFNGUkBhRoOH3cIPm-97UEBZmcFkbKGjzBbKWc0/edit?usp=drive_open\&ouid=118183464940790632947}{this}.}{c. Should end up with something that looks like this.}}\label{c.-should-end-up-with-something-that-looks-like-this.}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{names}\NormalTok{(df_clean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "discipline"         "st_id"              "firstgen"          
##  [4] "ethniccode"         "ethniccode_cat"     "urm"               
##  [7] "gender"             "female"             "famincome"         
## [10] "lowincomflag"       "transfer"           "international"     
## [13] "ell"                "us_hs"              "cohort"            
## [16] "cohort_2013"        "cohort_2014"        "cohort_2015"       
## [19] "cohort_2016"        "cohort_2017"        "cohort_2018"       
## [22] "apyear"             "englsr"             "mathsr"            
## [25] "hsgpa"              "crs_sbj_2"          "crs_catalog_2"     
## [28] "crs_name_2"         "numgrade_2"         "numgrade_w_2"      
## [31] "crs_retake_2"       "crs_term_2"         "crs_term_yr_2"     
## [34] "crs_term_sem_2"     "summer_crs_2"       "TERM_REF_2"        
## [37] "enrl_from_cohort_2" "crs_credits_2"      "crs_component_2"   
## [40] "class_number_2"     "current_major_2"    "crs_sbj"           
## [43] "crs_catalog"        "crs_name"           "numgrade"          
## [46] "numgrade_w"         "crs_retake"         "crs_term"          
## [49] "crs_termr.y"        "crs_term_sem"       "summer_crs"        
## [52] "TERM_REF"           "enrl_from_cohort"   "crs_credits"       
## [55] "crs_component"      "class_number"       "current_major"     
## [58] "aptaker"            "apscore"            "apscore_full"      
## [61] "apskipper"          "tookcourse"         "tookcourse_2"      
## [64] "skipped_1"
\end{verbatim}

\section{\texorpdfstring{\textbf{Data Analysis (Same Across
Institutions)}}{Data Analysis (Same Across Institutions)}}\label{data-analysis-same-across-institutions}

\subsection{0. Startup}\label{startup-1}

\subsubsection{a. Load R pkgs}\label{a.-load-r-pkgs-1}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{ (}\OperatorTok{!}\KeywordTok{require}\NormalTok{(}\StringTok{"pacman"}\NormalTok{)) }\KeywordTok{install.packages}\NormalTok{(}\StringTok{"pacman"}\NormalTok{)}
\KeywordTok{library}\NormalTok{(pacman)}
\NormalTok{pacman}\OperatorTok{::}\KeywordTok{p_load}\NormalTok{(}\StringTok{"tidyverse"}\NormalTok{, }\StringTok{"epiDisplay"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{b. Load full dataset}\label{b.-load-full-dataset-1}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# CHANGE TO YOUR FILE PATH}
\NormalTok{df_clean <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"~/YOUR FILE PATH HERE.csv"}\NormalTok{)}
\KeywordTok{head}\NormalTok{(}\KeywordTok{names}\NormalTok{(df_clean))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "X"              "discipline"     "st_id"          "firstgen"      
## [5] "ethniccode"     "ethniccode_cat"
\end{verbatim}

\subsubsection{c. Filter for student level inclusion/exclusion
criteria}\label{c.-filter-for-student-level-inclusionexclusion-criteria}

\begin{itemize}
\tightlist
\item
  Include:

  \begin{itemize}
  \tightlist
  \item
    First time freshmen
  \item
    Took course 2
  \item
    Cohort 2013-2018
  \end{itemize}
\item
  Exclude:

  \begin{itemize}
  \tightlist
  \item
    Transfer students
  \item
    International students
  \item
    Honors
  \end{itemize}
\end{itemize}

\subsubsection{d. Create dataframes for each
analysis}\label{d.-create-dataframes-for-each-analysis}

\begin{itemize}
\tightlist
\item
  For each course: Full Sample, AP taken after test re-design
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Bio}
\CommentTok{# Took 2nd course in sequence}
\NormalTok{df_bio2 <-}\StringTok{ }\NormalTok{df_clean }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{subset}\NormalTok{(discipline }\OperatorTok{==}\StringTok{ "BIO"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{subset}\NormalTok{(apyear }\OperatorTok{>=}\StringTok{ }\DecValTok{2013}\NormalTok{)}

\CommentTok{# repeat for Chem, Phys}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  For each course: Took AP
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Took AP }
\NormalTok{df_BYtakers <-}\StringTok{ }\NormalTok{df_clean }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{subset}\NormalTok{(discipline }\OperatorTok{==}\StringTok{ "BIO"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{subset}\NormalTok{(aptaker }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{)}

\CommentTok{# repeat for Chem, Phys}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  For each course: Recieved a skip-eligible score
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Skip eligible}
\NormalTok{df_BYeligible <-}\StringTok{ }\NormalTok{df_clean }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{subset}\NormalTok{(discipline }\OperatorTok{==}\StringTok{ "BIO"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{subset}\NormalTok{(apskipper }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{)}

\CommentTok{# repeat for Chem, Phys}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  For each course: Recieved a skip-eligible score (at each eligible
  score)
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Skip eligible (at each eligble scores)}
\NormalTok{df_BYeligible.}\DecValTok{4}\NormalTok{ <-}\StringTok{ }\NormalTok{df_bio2 }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{subset}\NormalTok{(apscore }\OperatorTok{==}\StringTok{ }\DecValTok{4}\NormalTok{)}
\NormalTok{df_BYeligible.}\DecValTok{5}\NormalTok{ <-}\StringTok{ }\NormalTok{df_bio2 }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{subset}\NormalTok{(apscore }\OperatorTok{==}\StringTok{ }\DecValTok{5}\NormalTok{)}

\CommentTok{# Repeat for Chem, Phys}
\end{Highlighting}
\end{Shaded}

\subsection{1. Run Models (for each
Course)}\label{run-models-for-each-course}

(see also
\href{https://docs.google.com/spreadsheets/d/1rN8W_iz1mr7lEzBGfdTZHa45wKOSLiSF8VEpChCPsmE/edit\#gid=129222174}{Sample
Descriptions} for model specs.)

\subsection{RQ1: What student characteristics are associated with
student participation and success in AP courses for students enrolled at
the selected
universities?}\label{rq1-what-student-characteristics-are-associated-with-student-participation-and-success-in-ap-courses-for-students-enrolled-at-the-selected-universities}

\subsection{\texorpdfstring{\emph{RQ1a: Who takes
AP?}}{RQ1a: Who takes AP?}}\label{rq1a-who-takes-ap}

\begin{itemize}
\tightlist
\item
  Sample: Took Course 2 dataframe
\item
  DV: aptaker
\item
  IV: factor(firstgen) + factor(lowincomflag) + factor(female) +
  factor(urm) + scale(hsgpa) + scale(mathsr) + scale(englsr)
\item
  COV: factor(cohort)
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Model 1a: Credits ####}
\CommentTok{#Bio}
\NormalTok{m1.a_bio <-}\StringTok{ }\KeywordTok{glm}\NormalTok{(aptaker }\OperatorTok{~}\StringTok{ }\KeywordTok{factor}\NormalTok{(firstgen) }\OperatorTok{+}\StringTok{ }\KeywordTok{factor}\NormalTok{(lowincomflag)  }\OperatorTok{+}\StringTok{ }\KeywordTok{factor}\NormalTok{(female) }\OperatorTok{+}\StringTok{ }\KeywordTok{factor}\NormalTok{(urm) }\OperatorTok{+}
\StringTok{                 }\KeywordTok{scale}\NormalTok{(hsgpa) }\OperatorTok{+}\StringTok{ }\KeywordTok{scale}\NormalTok{(mathsr) }\OperatorTok{+}\StringTok{ }\KeywordTok{scale}\NormalTok{(englsr) }\OperatorTok{+}\StringTok{ }\KeywordTok{factor}\NormalTok{(enrl_from_cohort),}
               \KeywordTok{binomial}\NormalTok{(}\DataTypeTok{link =} \StringTok{"logit"}\NormalTok{), df_bio2)}
\KeywordTok{logistic.display}\NormalTok{(m1.a_bio)}

\CommentTok{# Repeat for Chem, Phys}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{logistic.display}\NormalTok{(m1.a_bio)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  
##                                        OR  lower95ci  upper95ci     Pr(>|Z|)
## factor(firstgen)1            1.061059e+00 0.77605614  1.4507279 7.103658e-01
## factor(lowincomflag)1        9.336068e-01 0.70265811  1.2404634 6.356362e-01
## factor(female)1              8.664525e-01 0.72289022  1.0385256 1.209106e-01
## factor(urm)1                 1.167308e+00 0.86487668  1.5754941 3.119529e-01
## scale(hsgpa)                 9.685349e-01 0.88305993  1.0622834 4.976338e-01
## scale(mathsr)                1.099148e+00 0.98850133  1.2221806 8.075492e-02
## scale(englsr)                1.036213e+00 0.93368411  1.1500009 5.033831e-01
## factor(enrl_from_cohort)1.5  4.782860e-01 0.37706970  0.6066716 1.205953e-09
## factor(enrl_from_cohort)1.66 8.037013e-01 0.50238773  1.2857315 3.619950e-01
## factor(enrl_from_cohort)2    4.246465e-01 0.26461771  0.6814536 3.862889e-04
## factor(enrl_from_cohort)2.5  7.921156e-02 0.01833322  0.3422461 6.837549e-04
## factor(enrl_from_cohort)2.66 6.623396e-01 0.31820030  1.3786718 2.707070e-01
## factor(enrl_from_cohort)3    9.115404e-01 0.30393872  2.7337941 8.687222e-01
## factor(enrl_from_cohort)3.5  1.883956e+00 0.16982774 20.8993588 6.059368e-01
## factor(enrl_from_cohort)3.66 7.875640e-01 0.25184226  2.4628793 6.814186e-01
## factor(enrl_from_cohort)4    1.283459e-06 0.00000000        Inf 9.797858e-01
## factor(enrl_from_cohort)4.5  7.058345e-07 0.00000000        Inf 9.788950e-01
## factor(enrl_from_cohort)4.66 1.264938e-06 0.00000000        Inf 9.797642e-01
\end{verbatim}

\subsection{\texorpdfstring{\emph{RQ1b.}}{RQ1b.}}\label{rq1b.}

\begin{itemize}
\tightlist
\item
  Sample: Took AP dataframe
\item
  DV: apscore
\item
  IV: factor(firstgen) + factor(lowincomflag) + factor(female) +
  factor(urm) + scale(hsgpa) + scale(mathsr) + scale(englsr)
\item
  COV: factor(crs\_term)
\end{itemize}

\subsection{(Etc\ldots{}.)}\label{etc.}

\end{document}
